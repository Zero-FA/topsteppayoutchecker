<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Topstep Funded Payout Checker</title>
<link rel="icon" href="data:,">
<style>
  :root{
    /* Brand-ish colors (Topstep-y) */
    --bg:#f5f7fb;
    --bg2:#ffffff;
    --card:#ffffff;
    --card-soft:#f9fafb;
    --ink:#111827;
    --muted:#6b7280;
    --line:#e5e7eb;
    --good:#10b981;
    --bad:#ef4444;
    --pill:#ecfdf3;
    --accent:#0ea5e9;
  }

  *{box-sizing:border-box}

  body{
    margin:0;
    background:
      radial-gradient(circle at top left, #e0f2fe 0, #f5f7fb 55%),
      radial-gradient(circle at bottom right, #fef9c3 0, #f5f7fb 60%);
    color:var(--ink);
    font:16px/1.5 system-ui,Segoe UI,Roboto,Helvetica,Arial;
  }

  .wrap{
    max-width:1120px;
    margin:32px auto 40px;
    padding:0 16px;
  }

  .h1{
    font-weight:800;
    font-size:26px;
    margin-bottom:4px;
    letter-spacing:.01em;
    color:#020617;
  }

  .sub{
    color:var(--muted);
    margin-bottom:4px;
    font-size:13px;
  }

  .disclaimer{
    color:#9ca3af;
    font-size:11px;
    margin-top:2px;
    margin-bottom:10px;
  }

  .card{
    background:var(--card);
    border:1px solid var(--line);
    border-radius:18px;
    padding:16px 16px 14px;
    box-shadow:0 14px 30px rgba(15,23,42,.06);
  }

  .card-soft{
    background:var(--card-soft);
    border-radius:16px;
    border:1px solid #e5e7eb;
    padding:12px 14px;
  }

  .grid{display:grid;gap:12px}
  .cols2{grid-template-columns:1fr 1fr}

  .label{
    font-size:11px;
    color:var(--muted);
    margin-bottom:4px;
    text-transform:uppercase;
    letter-spacing:.06em;
  }

  .input,.select{
    width:100%;
    border:1px solid #d1d5db;
    background:#ffffff;
    color:var(--ink);
    border-radius:10px;
    padding:8px 10px;
    font:13px system-ui,Segoe UI,Roboto,Helvetica,Arial;
    transition:border-color .12s ease, box-shadow .12s ease, background-color .12s ease;
  }

  .input:focus,.select:focus{
    outline:none;
    border-color:var(--accent);
    box-shadow:0 0 0 1px rgba(14,165,233,.35);
    background:#f9fafb;
  }

  .help{
    font-size:12px;
    color:var(--muted);
    margin-top:3px;
  }

  .row{display:flex;gap:8px;align-items:center}
  .row-between{display:flex;justify-content:space-between;align-items:center;gap:8px}

  .pill{
    display:inline-flex;
    align-items:center;
    gap:6px;
    padding:4px 10px;
    border-radius:999px;
    font-size:11px;
    background:var(--pill);
    border:1px solid rgba(16,185,129,.4);
    color:#166534;
  }

  .pill-bad{
    background:#fef2f2;
    border-color:#fecaca;
    color:#b91c1c;
  }

  .pill span.dot{
    width:6px;
    height:6px;
    border-radius:999px;
    background:currentColor;
  }

  #yesno span:last-child {
    font-size:18px;
    font-weight:700;
  }

  .tile{
    background:#ffffff;
    border:1px solid #e5e7eb;
    border-radius:12px;
    padding:8px 10px;
  }

  .tile-label{
    font-size:11px;
    color:var(--muted);
    margin-bottom:3px;
  }

  .tile-main{
    font-size:14px;
    font-weight:600;
    color:#111827;
  }

  .range{
    background:#ecfdf5;
    border:1px solid #a7f3d0;
    color:#047857;
    border-radius:12px;
    padding:9px 10px;
  }

  .list{list-style:none;padding:0;margin:0}
  .list li{
    display:flex;
    gap:8px;
    align-items:flex-start;
    padding:5px 0;
    border-bottom:1px dashed #e5e7eb;
  }
  .list li:last-child{border-bottom:0}

  .mono{
    font:11px ui-monospace,Consolas,Menlo,monospace;
  }

  hr{
    border:none;
    border-top:1px dashed #e5e7eb;
    margin:10px 0;
  }

  svg{flex:0 0 auto}

  .tag{
    display:inline-flex;
    align-items:center;
    gap:4px;
    padding:3px 9px;
    border-radius:999px;
    border:1px solid rgba(14,165,233,.4);
    background:#e0f2fe;
    font-size:11px;
    color:#075985;
  }

  .top-bar{
    display:flex;
    justify-content:space-between;
    align-items:flex-start;
    gap:8px;
    flex-wrap:wrap;
  }

  .aff-btn{
    display:inline-block;
    padding:8px 14px;
    background:linear-gradient(135deg,#0ea5e9,#22c55e);
    border:1px solid rgba(59,130,246,.35);
    border-radius:999px;
    color:white;
    font-weight:600;
    font-size:12px;
    text-decoration:none;
    box-shadow:0 10px 25px rgba(15,23,42,.18);
    transition:transform .12s ease, box-shadow .12s ease, filter .12s ease;
  }

  .aff-btn:hover{
    filter:brightness(1.04);
    transform:translateY(-1px);
    box-shadow:0 14px 30px rgba(15,23,42,.22);
  }

  .top-bar-boost{
    background:#ecfdf5;
    border:1px solid #bbf7d0;
    padding:12px 16px;
    border-radius:14px;
    margin-bottom:14px;
    text-align:center;
    font-size:15px;
    font-weight:600;
    color:#166534;
  }

  .top-bar-boost strong{
    color:#0f766e;
  }

  .deal-size{
    text-shadow:0 0 12px rgba(56,189,248,.55);
    font-size:26px;
    font-weight:900;
    background:linear-gradient(90deg,#0ea5e9,#22c55e);
    -webkit-background-clip:text;
    color:transparent;
  }

  /* Trading rules layout */
  .rules-grid{
    display:grid;
    grid-template-columns:repeat(2,minmax(0,1fr));
    gap:4px 10px;
  }
  .rules-grid li{
    border-bottom:none;
    padding:2px 0;
  }
  .rule-main{display:flex;align-items:center;gap:6px}
  .rule-main label{font-size:12px;font-weight:500;cursor:pointer}
  .rule-link{
    font-size:11px;
    color:var(--accent);
    text-decoration:none;
  }
  .rule-link:hover{text-decoration:underline}

  /* Accordion (Eligibility Checklist) */
  .accordion-header{
    display:flex;
    align-items:center;
    justify-content:space-between;
    cursor:pointer;
    padding:4px 0 2px 0;
  }
  .accordion-title{
    font-weight:600;
    font-size:13px;
  }
  .accordion-icon{
    font-size:12px;
    color:var(--muted);
    margin-left:6px;
  }
  .accordion-body{
    margin-top:6px;
    display:none;
  }

  /* What to Fix badge */
  .fix-badge{
    display:inline-flex;
    align-items:center;
    gap:6px;
    font-size:11px;
    color:#7f1d1d;
    background:#fef2f2;
    border-radius:999px;
    padding:3px 8px;
    border:1px solid #fecaca;
    margin-bottom:6px;
  }

  @media (max-width:920px){
    .cols2{grid-template-columns:1fr}
  }
</style>
</head>
<body>
<div class="wrap">

  <!-- Promo / affiliate banner -->
  <div class="top-bar-boost">
    ðŸ’° Trading with <strong>Topstep</strong>? Use your funded days wisely and check payout eligibility before you click withdraw.
  </div>

  <!-- Header -->
  <div class="top-bar">
    <div>
      <div class="h1">Topstep Funded Payout Checker</div>
      <div class="sub">Estimate payout eligibility for Express Funded vs Live Funded rules.</div>
      <div class="disclaimer">
        Unofficial tool. For guidance only â€” final decisions are made by Topstep according to their most recent policies.
      </div>
    </div>
    <div style="text-align:right;min-width:200px;">
      <a href="https://topstep.com" target="_blank" class="aff-btn">
        Open / manage your Topstep account â†’
      </a>
    </div>
  </div>

  <!-- Main grid -->
  <div class="grid cols2" style="gap:16px;align-items:start;margin-top:10px;">

    <!-- LEFT COLUMN -->
    <div class="grid" style="gap:12px;">

      <!-- Form + Trading Rules -->
      <div class="card">

        <!-- Account / firm selection -->
        <div class="grid cols2" style="gap:10px 12px">
          <div>
            <div class="label">Funded Account Type</div>
            <select id="firm" class="select">
              <option value="express">Express Funded Account (XFA)</option>
              <option value="live">Live Funded Account</option>
            </select>
            <div id="firmHelp" class="help">
              Express = simulated funded level. Live = real funded account after multiple payouts.
            </div>
          </div>

          <div>
            <div class="label">Account Size</div>
            <select id="account" class="select">
              <option value="50k" selected>$50K</option>
              <option value="100k">$100K</option>
              <option value="150k">$150K</option>
            </select>
            <div class="help">
              Max loss limit & suggested sizing depend on this.
            </div>
          </div>

          <div>
            <div class="label">Account Status</div>
            <select id="accountStatus" class="select">
              <option value="active" selected>Active / In Good Standing</option>
              <option value="closed">Closed / Violation</option>
            </select>
            <div class="help">
              If the account was closed for MLL or rule violation, it will not be payout-eligible.
            </div>
          </div>

          <div>
            <div class="label">Current Account Balance ($)</div>
            <input id="currentBalance" class="input" inputmode="decimal" placeholder="e.g., 54400" />
            <div class="help">
              Full balance shown in your funded account dashboard.
            </div>
          </div>

          <div>
            <div class="label">Requested Payout ($)</div>
            <input id="requestedPayout" class="input" inputmode="decimal" placeholder="e.g., 500" />
            <div id="minPayoutHelp" class="help">
              Min payout is $125. Caps & 50% rules apply by account type.
            </div>
          </div>
        </div>

        <hr />

        <!-- Performance inputs -->
        <div class="grid cols2" style="gap:10px 12px">

          <div>
            <div class="label">Winning Days Since Last Payout</div>
            <input id="winningDays" class="input" type="number" min="0" placeholder="e.g., 5" />
            <div class="help">
              Days with Net PnL â‰¥ $150 (or â‰¥$200 on legacy dashboard).
            </div>
          </div>

          <div>
            <div class="label">Smallest Net PnL on Winning Days ($)</div>
            <input id="minWinPnl" class="input" inputmode="decimal" placeholder="e.g., 150.77" />
            <div class="help">
              Used to check that each winning day actually qualifies.
            </div>
          </div>

          <div id="liveOnlyWrap">
            <div class="label">Total Winning Days in Live (All Time)</div>
            <input id="totalLiveWins" class="input" type="number" min="0" placeholder="e.g., 18" />
            <div class="help">
              At 30 winning days in <b>Live</b>, you unlock daily payouts and 100% withdrawals.
            </div>
          </div>
        </div>

        <hr style="margin-top:12px;margin-bottom:8px;">

        <!-- Trading Rule Compliance -->
        <div class="row-between" style="margin-bottom:4px;">
          <div style="font-weight:600;font-size:16px;">Trading Rule Compliance (Required)</div>
          <div class="tag">
            <span style="width:7px;height:7px;border-radius:999px;background:var(--good);"></span>
            Must be TRUE for payout
          </div>
        </div>
        <div style="font-size:14px;color:var(--muted);margin-bottom:6px;">
          Confirm you did <b>not</b> violate any Topstep rules during this payout period. If you did, contact Support before requesting.
        </div>
        <ul id="rulesList" class="list rules-grid"></ul>
      </div>

      <!-- Eligibility Checklist -->
      <div class="card">
        <div id="checklistHeader" class="accordion-header">
          <div class="accordion-title">Eligibility Checklist</div>
          <div style="display:flex;align-items:center;gap:6px;">
            <span class="help" style="margin-top:0;font-size:10px;">Click to expand</span>
            <span id="checklistIcon" class="accordion-icon">â–¶</span>
          </div>
        </div>
        <div class="help" style="margin-top:4px;margin-bottom:2px;">
          Updates automatically based on your numbers and rule confirmations.
        </div>
        <div id="checklistBody" class="accordion-body">
          <ul id="checklist" class="list" style="margin-top:4px;"></ul>
        </div>
      </div>
    </div>

    <!-- RIGHT COLUMN -->
    <div class="grid" style="gap:12px;">

      <!-- Summary -->
      <div id="summaryCard" class="card" style="border-color:#e5e7eb;">
        <div class="row-between">
          <div class="row" style="gap:6px">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none"
                 stroke="currentColor" stroke-width="2">
              <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
              <path d="M22 4 12 14.01l-3-3"></path>
            </svg>
            <div>
              <div style="font-weight:700;font-size:20px">Should this payout be approved?</div>
              <div id="summarySubtitle" style="font-size:14px;color:var(--muted);">
                Based on Topstep funded-account rules and your inputs.
              </div>
            </div>
          </div>
          <div style="text-align:right;">
            <a id="policyLink"
               href="https://help.topstep.com/en/articles/8284233-topstep-payout-policy"
               target="_blank"
               style="font-size:11px;color:#0ea5e9;text-decoration:none;">
               View Payout Policy â†’
            </a>
          </div>
        </div>

        <div style="display:flex;align-items:center;gap:12px;margin:8px 0 10px 0;">
          <div id="yesno" class="pill">
            <span class="dot"></span>
            <span>YES</span>
          </div>
          <div style="font-size:13px;color:var(--muted);">
            You still must follow Topstepâ€™s official dashboard & Help Center. This is an estimator only.
          </div>
        </div>

        <!-- Quick stats -->
        <div class="grid cols2" style="gap:8px 10px;margin-bottom:6px;">
          <div class="tile">
            <div class="tile-label">Max loss limit (trailing)</div>
            <div class="tile-main" id="mllValue">â€”</div>
            <div class="help">
              If your Net PnL ever hits this level intraday, the account can be closed.
            </div>
          </div>
          <div class="tile">
            <div class="tile-label">Max allowed payout this request</div>
            <div class="tile-main" id="maxCap">â€”</div>
            <div class="help" id="maxCapHelp">
              Express: up to $5,000 or 50% of profit. Live: 50% of profit until 30 winning days, then up to 100%.
            </div>
          </div>
          <div class="tile">
            <div class="tile-label">Minimum payout</div>
            <div class="tile-main" id="minPay">$125</div>
            <div class="help">Requests below this will not qualify.</div>
          </div>
          <div class="tile">
            <div class="tile-label">Profit split (est.)</div>
            <div class="tile-main" id="profitSplit">100% of first $10k; 90/10 after</div>
            <div class="help">
              Split applies per trader across all funded accounts.
            </div>
          </div>
        </div>

        <!-- Allowed payout range -->
        <div id="rangeWrap" class="range" style="margin-top:6px;display:none;">
          <div style="font-size:11px;margin-bottom:2px;">Estimated allowed payout range</div>
          <div id="range" style="font-weight:700;font-size:14px">$â€” â€“ $â€”</div>
        </div>
      </div>

      <!-- What to fix -->
      <div id="adviceWrap" class="card-soft" style="display:none;">
        <div class="fix-badge">
          <span style="width:8px;height:8px;border-radius:999px;background:#fecaca;"></span>
          What you may need to fix before requesting
        </div>
        <ul id="adviceList" class="list"></ul>
      </div>

      <!-- Notes -->
      <div class="card mono" style="font-size:11px;color:var(--muted);">
        Notes: Express & Live Funded payouts require at least five winning trading days with
        Net PnL around $150â€“$200 per day. Express withdrawals are capped at the lesser of
        $5,000 or 50% of account balance. Live withdrawals are also limited to 50% until you
        accumulate 30 winning days in Live; after that, you can request daily payouts of up
        to 100% of the balance. Minimum payout is $125. This tool does not guarantee approval
        and may lag recent rule changes â€” always verify against Topstepâ€™s Help Center.
      </div>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  /* ---------- Config & Helpers ---------- */
  const ACCOUNT_CONFIG = {
    "50k": { label:"$50K", maxLossLimit:2000, maxContracts:5 },
    "100k": { label:"$100K", maxLossLimit:3000, maxContracts:10 },
    "150k": { label:"$150K", maxLossLimit:4500, maxContracts:15 }
  };

  const FIRM_RULES = {
    express: [
      {
        key:"mll",
        label:"Did NOT hit or exceed the Maximum Loss Limit",
        fix:"If your Net PnL ever touched the Maximum Loss Limit intraday, the account may be ineligible or closed."
      },
      {
        key:"scaling",
        label:"Followed the Scaling Plan (contract limits)",
        fix:"Make sure your max contracts stayed within the Scaling Plan for your account size."
      },
      {
        key:"prohibited",
        label:"No prohibited conduct (copy trading, account sharing, etc.)",
        fix:"Resolve any issues with account sharing, copied signals, or other prohibited conduct before requesting payout."
      }
    ],
    live: [
      {
        key:"mll",
        label:"Did NOT hit or exceed the Maximum Loss Limit",
        fix:"A hit/violation of the Maximum Loss Limit can end the funded account; clarify status with Support if unsure."
      },
      {
        key:"scaling",
        label:"Stayed within Scaling Plan / max size for Live",
        fix:"Keep position sizing within Topstepâ€™s limits for your Live account size."
      },
      {
        key:"prohibited",
        label:"No prohibited conduct or regulatory issues",
        fix:"Confirm there were no prohibited behaviors or broker/compliance flags during the period."
      }
    ]
  };

  const RULE_LINKS = {
    mll: "https://help.topstep.com/en/articles/8284204-what-is-the-maximum-loss-limit",
    scaling: "https://help.topstep.com/en/articles/8284223-what-is-the-scaling-plan",
    prohibited: "https://help.topstep.com/en/articles/10296582-prohibited-conduct"
  };

  const $ = s => document.querySelector(s);
  const fmt = n => (n==null || Number.isNaN(n) ? "â€”" :
    Number(n).toLocaleString(undefined,{maximumFractionDigits:2}));
  const num = s => {
    const v = Number(String(s||"").replace(/[^0-9.-]/g,""));
    return Number.isFinite(v) ? v : 0;
  };

  /* ---------- Build Trading Rule Checkboxes ---------- */
  const rulesList = $("#rulesList");

  function renderRules() {
    const firm = $("#firm").value;
    rulesList.innerHTML = "";
    FIRM_RULES[firm].forEach(rule => {
      const li = document.createElement("li");
      li.innerHTML = `
        <div class="rule-main">
          <input type="checkbox" id="rule_${rule.key}" data-rule="${rule.key}" />
          <label for="rule_${rule.key}">${rule.label}</label>
        </div>
        <a href="${RULE_LINKS[rule.key]}" target="_blank" class="rule-link">
          Learn more â†’
        </a>
      `;
      rulesList.appendChild(li);
    });

    // re-wire checkbox listeners
    rulesList.querySelectorAll("input[type='checkbox']").forEach(box => {
      box.addEventListener("input", render);
    });
  }

  /* ---------- Evaluation Logic for Express & Live ---------- */

  function evaluate(inputs) {
    const cfg = ACCOUNT_CONFIG[inputs.account];
    const firm = inputs.firm;

    // starting balances for calculating profit from balance
    const STARTING_BALANCES = {
      "50k": 50000,
      "100k": 100000,
      "150k": 150000
    };

    // compute actual profit: currentBalance - startingBalance
    const profitFromBalance = Math.max(
      0,
      inputs.currentBalance - STARTING_BALANCES[inputs.account]
    );

    const minPayout = 125;

    /* --- Winning-day validity --- */
    const fiveWinningDays = inputs.winningDays >= 5;
    const minWinThresholdOK = inputs.minWinPnl >= 125; // using $125 floor

    /* --- Max Loss Limit threshold display --- */
    const mllValue = cfg.maxLossLimit;

    /* --- LIVE FUNDED special rule --- */
    const live30Days = inputs.totalLiveWins >= 30;

    /* --- Compute max allowed payout based on firm --- */
    let maxAllowed = 0;

    if (firm === "express") {
      const fiftyPercent = profitFromBalance * 0.5;
      maxAllowed = Math.min(5000, fiftyPercent);
    } else {
      // LIVE
      if (live30Days) {
        maxAllowed = profitFromBalance;         // full profit available
      } else {
        maxAllowed = profitFromBalance * 0.5;   // 50% rule pre-30 wins
      }
    }

    // ensure non-negative
    maxAllowed = Math.max(0, Math.floor(maxAllowed));

    /* --- Payout meets min --- */
    const meetsMin = inputs.requestedPayout >= minPayout;

    /* --- Requested payout <= cap --- */
    const underCap = inputs.requestedPayout <= maxAllowed;

    /* --- Account status must be active --- */
    const activeOK = inputs.accountStatus === "active";

    /* --- Trading Rules --- */
    const ruleReasons = [];
    let allTradingRulesPass = true;

    FIRM_RULES[firm].forEach(rule => {
      const box = document.querySelector(`#rule_${rule.key}`);
      const checked = box && box.checked;
      ruleReasons.push({
        pass: checked,
        label: rule.label,
        detail: checked
          ? "Confirmed."
          : rule.fix
      });
      if (!checked) allTradingRulesPass = false;
    });

    /* --- Final eligibility --- */
    const passesAll =
      fiveWinningDays &&
      minWinThresholdOK &&
      activeOK &&
      meetsMin &&
      underCap &&
      allTradingRulesPass;

    const reasons = [
      {
        pass: activeOK,
        label: "Account is active / in good standing",
        detail: activeOK ? "" : "Account closed or violated."
      },
      {
        pass: fiveWinningDays,
        label: "â‰¥ 5 winning trading days since last payout",
        detail: `You have ${inputs.winningDays}.`
      },
      {
        pass: minWinThresholdOK,
        label: "Daily winning PnL meets minimum threshold",
        detail: `Lowest winning day: $${fmt(inputs.minWinPnl)}`
      },
      {
        pass: meetsMin,
        label: `Minimum payout request â‰¥ $${minPayout}`,
        detail: `Requested: $${fmt(inputs.requestedPayout)}`
      },
      {
        pass: underCap,
        label: "Requested payout â‰¤ allowed cap",
        detail: `Max allowed: $${fmt(maxAllowed)}`
      }
    ];

    // Append trading rule reasons
    reasons.push(...ruleReasons);

    /* --- Advice (What to Fix) --- */
    const advice = [];

    if (!activeOK) advice.push("Account must be active and not in violation status.");
    if (!fiveWinningDays) advice.push("Need at least 5 winning days since last payout.");
    if (!minWinThresholdOK) advice.push("Lowest winning day must be at least about $125â€“$150.");
    if (!meetsMin) advice.push(`Minimum payout is $${minPayout}.`);
    if (!underCap) {
      advice.push(
        `Requested payout exceeds allowed maximum of $${fmt(maxAllowed)}.`
      );
    }

    // add trading rule fixes
    ruleReasons.forEach(r => {
      if (!r.pass && r.detail) advice.push(r.detail);
    });

    /* --- Return evaluation package --- */
    return {
      eligible: passesAll,
      reasons,
      advice,
      computed: {
        mllValue,
        minPayout,
        maxAllowed
      }
    };
  }

  /* ---------- Gather Inputs ---------- */
  function getInputs() {
    return {
      firm: $("#firm").value,
      account: $("#account").value,
      accountStatus: $("#accountStatus").value,
      currentBalance: num($("#currentBalance").value),
      requestedPayout: num($("#requestedPayout").value),
      winningDays: Math.max(0, num($("#winningDays").value)),
      minWinPnl: num($("#minWinPnl").value),
      totalLiveWins: Math.max(0, num($("#totalLiveWins").value))
    };
  }

  /* ---------- Render UI from evaluation ---------- */
  function render() {
    const inputs = getInputs();
    const res = evaluate(inputs);

    /* YES / NO pill */
    const yesno = $("#yesno");
    yesno.className = res.eligible ? "pill" : "pill pill-bad";
    yesno.querySelector("span:last-child").textContent = res.eligible
      ? "YES"
      : "NO";

    /* Card border */
    $("#summaryCard").style.borderColor = res.eligible ? "#10b981" : "#ef4444";

    /* Summary numbers */
    $("#mllValue").textContent = `$${fmt(res.computed.mllValue)}`;
    $("#minPay").textContent = `$${fmt(res.computed.minPayout)}`;
    $("#maxCap").textContent = res.computed.maxAllowed
      ? `$${fmt(res.computed.maxAllowed)}`
      : "â€”";

    /* Allowed range */
    const rangeWrap = $("#rangeWrap");
    if (res.eligible) {
      const min = res.computed.minPayout;
      const max = res.computed.maxAllowed;
      if (max >= min) {
        rangeWrap.style.display = "block";
        $("#range").textContent = `$${fmt(min)} â€“ $${fmt(max)}`;
      }
    } else {
      rangeWrap.style.display = "none";
    }

    /* Checklist */
    const checklist = $("#checklist");
    checklist.innerHTML = "";
    res.reasons.forEach(r => {
      const li = document.createElement("li");
      li.innerHTML = `
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
             stroke="${r.pass ? '#10b981' : '#ef4444'}"
             stroke-width="2" style="margin-top:2px">
          ${
            r.pass
              ? '<path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><path d="M22 4 12 14.01l-3-3"></path>'
              : '<circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line>'
          }
        </svg>
        <div>
          <div style="font-weight:600;font-size:12px">${r.label}</div>
          ${r.detail ? `<div class="help">${r.detail}</div>` : ""}
        </div>
      `;
      checklist.appendChild(li);
    });

    /* Advice */
    const adviceWrap = $("#adviceWrap");
    const adviceList = $("#adviceList");
    adviceList.innerHTML = "";
    if (res.advice.length) {
      adviceWrap.style.display = "block";
      res.advice.forEach(a => {
        const li = document.createElement("li");
        li.innerHTML = `<div class="help" style="font-size:13px;">${a}</div>`;
        adviceList.appendChild(li);
      });
    } else {
      adviceWrap.style.display = "none";
    }
  }

  /* ---------- Event Listeners ---------- */

  document.querySelectorAll("input, select").forEach(el => {
    el.addEventListener("input", render);
  });

  // When switching between Express / Live, redraw rules + UI
  $("#firm").addEventListener("change", () => {
    const isLive = $("#firm").value === "live";
    $("#liveOnlyWrap").style.display = isLive ? "block" : "none";

    // Update payout policy link
    $("#policyLink").href =
      $("#firm").value === "express"
        ? "https://help.topstep.com/en/articles/8284233-topstep-payout-policy"
        : "https://help.topstep.com/en/articles/8284215-express-funded-account-parameters";

    renderRules();
    render();
  });

  /* ---------- Accordion toggle ---------- */
  $("#checklistHeader").addEventListener("click", () => {
    const body = $("#checklistBody");
    const icon = $("#checklistIcon");
    const open = body.style.display === "block";

    body.style.display = open ? "none" : "block";
    icon.textContent = open ? "â–¶" : "â–¼";
  });

  /* Initialize */
  renderRules();

  // Hide live-only field on initial load
  $("#liveOnlyWrap").style.display = $("#firm").value === "live" ? "block" : "none";

  render();
}); // DOMContentLoaded
</script>

<script src="https://cdn.vercel-insights.com/v1/script.js" defer></script>
</body>
</html>
